#sets a global variable, can be used anywhere
effect_set_catholic_authority_global = {
	set_global_variable = {
		name = global_catholic_authority
		value = 0
	}
	every_country = {
		limit = {
			OR = {
				country_controls_vatican = yes
				has_catholic_presence = yes
			}
		}
		debug_log_scopes = yes
		if = {
			limit = {
				country_controls_vatican = yes
			}
			change_global_variable = {
				name = global_catholic_authority
				add = catholic_authority_rome
			}
		}
		else_if = {
			limit = {
				religion = rel:catholic
			}
			change_global_variable = {
				name = global_catholic_authority
				add = catholic_authority
			}
		}
		else = {
			change_global_variable = {
				name = global_catholic_authority
				add = catholic_authority_minority
			}
		}
	}
}

#papal succession. assumes that we have saved scope old_pope
#called from within the country controlling the vatican
effect_papal_succession = {
	random_list = {
		#1846 Enclave Characters
		200 = {
			trigger = {
				year > 1831
				year < 1854
				NOT = {
					scope:old_pope ?= {
						has_template = luigi_lambruschini_template
					}
				}
			}
			modifier = {
				if = {
					limit = {
						#conservative great powers
						c:FRA ?= {
							has_law = law_type:law_monarchy
							country_rank >= rank_value:major_power
							OR = {
								has_law = law_type:law_autocracy
								has_law = law_type:law_landed_voting
								has_law = law_type:law_oligarchy
								has_law = law_type:law_single_party_state
							}
						}
						c:AUS ?= {
							has_law = law_type:law_monarchy
							country_rank >= rank_value:major_power
							OR = {
								has_law = law_type:law_autocracy
								has_law = law_type:law_landed_voting
								has_law = law_type:law_oligarchy
								has_law = law_type:law_single_party_state
							}
						}
					}
					add = 200
				}
				if = {
					limit = {
						has_global_variable = peoples_springtime_recent
					}
					add = -300
				}
			}
			if = {
				limit = {
					any_scope_character = {
						has_template = luigi_lambruschini_template
					}
				}
				random_scope_character = {
					limit = {
						has_template = luigi_lambruschini_template
					}
					save_scope_as = new_pope
				}
			}
			else_if = {
				limit = {
					any_character_in_void = {
						has_template = luigi_lambruschini_template
						is_character_alive = yes
					}
				}
				save_scope_as = new_pope
			}
			else = {
				create_character = {
					template = luigi_lambruschini_template
					save_scope_as = new_pope
				}
			}
		}
		200 = {
			trigger = {
				year >= 1839
				year <= 1876
				NOT = {
					scope:old_pope ?= {
						has_template = giovanni_ferretti_template
					}
				}
			}
			modifier = {
				if = {
					limit = {
						c:FRA ?= {
							has_law = law_type:law_monarchy
							country_rank >= rank_value:major_power
							OR = {
								has_law = law_type:law_autocracy
								has_law = law_type:law_landed_voting
								has_law = law_type:law_oligarchy
								has_law = law_type:law_single_party_state
							}
						}
						c:AUS ?= {
							has_law = law_type:law_monarchy
							country_rank >= rank_value:major_power
							OR = {
								has_law = law_type:law_autocracy
								has_law = law_type:law_landed_voting
								has_law = law_type:law_oligarchy
								has_law = law_type:law_single_party_state
							}
						}
						has_global_variable = peoples_springtime_recent
					}
					add = 400
				}
			}
			if = {
				limit = {
					any_scope_character = {
						has_template = giovanni_ferretti_template
					}
				}
				random_scope_character = {
					limit = {
						has_template = giovanni_ferretti_template
					}
					save_scope_as = new_pope
				}
			}
			else_if = {
				limit = {
					any_character_in_void = {
						has_template = giovanni_ferretti_template
						is_character_alive = yes
					}
				}
				save_scope_as = new_pope
			}
			else = {
				create_character = {
					template = giovanni_ferretti_template
					save_scope_as = new_pope
				}
			}
		}
		200 = {
			trigger = {
				year >= 1841
				year <= 1849
				NOT = {
					scope:old_pope ?= {
						has_template = tommaso_gizzi_template
					}
				}
			}
			modifier = {
				if = {
					limit = {
						c:FRA ?= {
							has_law = law_type:law_monarchy
							country_rank >= rank_value:major_power
							OR = {
								has_law = law_type:law_autocracy
								has_law = law_type:law_landed_voting
								has_law = law_type:law_oligarchy
								has_law = law_type:law_single_party_state
							}
						}
						c:AUS ?= {
							has_law = law_type:law_monarchy
							country_rank >= rank_value:major_power
							OR = {
								has_law = law_type:law_autocracy
								has_law = law_type:law_landed_voting
								has_law = law_type:law_oligarchy
								has_law = law_type:law_single_party_state
							}
						}
					}
					add = -400
				}
				if = {
					limit = {
						#springtime of peoples
						has_global_variable = peoples_springtime_recent
					}
					add = 400
				}
			}
			if = {
				limit = {
					any_scope_character = {
						has_template = tommaso_gizzi_template
					}
				}
				random_scope_character = {
					limit = {
						has_template = tommaso_gizzi_template
					}
					save_scope_as = new_pope
				}
			}
			else_if = {
				limit = {
					any_character_in_void = {
						has_template = tommaso_gizzi_template
						is_character_alive = yes
					}
				}
				save_scope_as = new_pope
			}
			else = {
				create_character = {
					template = tommaso_gizzi_template
					save_scope_as = new_pope
				}
			}
			
		}
		50 = {
			trigger = {
				year >= 1826
				year <= 1852
				NOT = {
					scope:old_pope ?= {
						has_template = tommaso_bernetti_template
					}
				}
			}
			if = {
				limit = {
					any_scope_character = {
						has_template = tommaso_bernetti_template
					}
				}
				random_scope_character = {
					limit = {
						has_template = tommaso_bernetti_template
					}
					save_scope_as = new_pope
				}
			}
			else_if = {
				limit = {
					any_character_in_void = {
						has_template = tommaso_bernetti_template
						is_character_alive = yes
					}
				}
				save_scope_as = new_pope
			}
			else = {
				create_character = {
					template = tommaso_bernetti_template
					save_scope_as = new_pope
				}
			}
		}
		# backup in case something odd happens and no other characters are eligible
		1 = {
			create_character = {
				female = no
				religion = rel:catholic
				interest_group = ig_devout
				save_scope_as = new_pope
			}
		}
	}
	#debug_log_scopes = yes
	#we have scope:new_pope now
	scope:new_pope = {
		set_variable = mdd_is_pope
		if = {
			limit = {
				owner = {
					is_papal_states = yes
				}
			}
			if = {
				limit = {
					owner = {
						has_papal_rule = yes
					}
				}
				set_character_as_ruler = yes
			}
			else = {
				set_as_interest_group_leader = yes
			}
		}
		else = {
			place_character_in_void = 1200
		}
	}
	trigger_event = {
		id = mdd_vatican.3
		days = 1
	}
}
