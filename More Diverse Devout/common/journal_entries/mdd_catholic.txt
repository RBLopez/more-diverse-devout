je_roman_question_italian = {
	icon = "gfx/interface/icons/religion_icons/catholic.dds"

	group = je_group_mdd_content

	is_shown_when_inactive = {
		NOT = {
			has_global_variable = roman_question_answered
		}
		is_papal_states = no
		OR = {
			country_has_primary_culture = cu:north_italian
			country_has_primary_culture = cu:south_italian
		}
	}

	possible = {
		is_papal_states = no
		has_variable = risorgimento_unifying_stance
		NOT = {
			has_global_variable = roman_question_answered
		}
	}

	complete = {
		has_global_variable = roman_question_answered
		#papal states forms italy
	}

	on_complete = {
		#??
	}

	fail = {
		#papal states is dead and didn't form italy
		#on_country_formed for italian formation if italy
		#on_war_end for war that takes over the country
	}

	on_fail = {
		#prisoner in the vatican (?)
	}

}

#'hidden' AI journal used to track if/when the papal states dies or country controlling the vatican dies
#may be redundant with better entry criteria for prisoner in the vatican
je_pope_tracker = {
	icon = "gfx/interface/icons/religion_icons/catholic.dds"

	fail = {
		NOT = { exists = c:PAP }
		OR = {
			NOT = { exists = c:ITA }
			NOT = {
				c:ITA ?= {
					was_formed_from = PAP
				}
			}
		}
		any_country = {
			country_controls_vatican = yes
			NOT = { has_journal_entry = je_prisoner_in_vatican }
			NOT = { has_journal_entry = je_holy_see }
		}
	}

	on_fail = {
		if = { #papal states just died
			limit = {
				NOT = { has_global_variable = mdd_papal_rule_ended }
			}
			add_global_variable = mdd_papal_rule_ended
			any_country = {
				country_controls_vatican = yes
				trigger_event = {
					id = mdd_vatican.1
				}
			}
		}
		#these are probably unnecessary with appropriate triggers for journal entries
		#else = { 
		#	if = {
		#		limit = {
		#			has_global_variable = mdd_roman_question_answered
		#		}
		#		any_country = {
		#			country_controls_vatican = yes
		#			trigger_event = {
		#				id = mdd_vatican.4
		#			}
		#		}
		#	}
		#	else = {
		#		any_country = {
		#			country_controls_vatican = yes
		#			trigger_event = {
		#				id = mdd_vatican.2
		#			}
		#		}
		#	}
		#}
	}


	is_shown_when_inactive = {
		is_ai = yes
		country_controls_vatican = no
        OR = {
            AND = {
                has_global_variable = mdd_pope_tracker
                OR = {
                    this = global_var:mdd_pope_tracker
                    global_var:mdd_pope_tracker = {
                        OR = {
                            is_country_alive = no
                            OR = {
                                is_ai = no
                                NOT = { # Human players eligible only if they conquered all the AIs
                                    any_country = {
                                        is_ai = yes
                                    }
                                }
                            }
                        }
                    }
                }
            }
            NOT = {
                has_global_variable = mdd_pope_tracker
            }
        }
	}

	possible = {
        always = yes
    }

	immediate = {
        if = {
            limit = {
                OR = {
                    NOT = {
                        has_global_variable = mdd_pope_tracker
                    }
                    global_var:mdd_pope_tracker = {
                        OR = {
                            is_country_alive = no
                            OR = {
                                is_ai = no
                                NOT = {
                                    any_country = {
                                        is_ai = yes
                                    }
                                }
                            }
                        }
                    }
                }
            }
            set_global_variable = {
                name  = mdd_pope_tracker
                value = this
            }
        }
    }
    
    invalid = {
        OR = {
            is_ai = no
            AND = {
                has_global_variable = mdd_pope_tracker
                this != global_var:mdd_pope_tracker
            }
        }
    }

}

je_roman_question_defender ={
	icon = "gfx/interface/icons/religion_icons/catholic.dds"

	group = je_group_mdd_content

	is_shown_when_inactive = {
		is_papal_states = no
		NOT = {
			has_global_variable = roman_question_answered
		}
		country_has_state_religion = rel:catholic
		country_rank >= rank_value:major_power
	}

	possible = {
		NOT = {
			has_global_variable = roman_question_answered
			has_variable = risorgimento_unifying_stance
		}
		is_papal_states = no
		country_has_state_religion = rel:catholic
		country_rank >= rank_value:major_power
		OR = {
			country_is_in_europe = yes
			has_variable = risorgimento_anti_unifying_stance
		}
		any_country = {
			has_variable = risorgimento_unifying_stance
		}
	}

	complete = {
		has_global_variable = roman_question_answered
		#papal states forms italy
	}

	on_complete = {
		#?
	}

	fail = {
		#papal states is dead and didn't form italy
	}

	on_fail = {
		#prisoner in the vatican (?)
	}

}

je_prisoner_in_vatican = {
	icon = "gfx/interface/icons/religion_icons/catholic.dds"

	group = je_group_mdd_content

	is_shown_when_inactive = {
		OR = {
			AND = {
				is_papal_states = no
				has_variable = risorgimento_unifying_stance
			}
			country_controls_vatican = yes
		}
		NOT = {
			has_global_variable = mdd_roman_question_answered
		}	
	}

	possible = {
		country_controls_vatican = yes
		has_papal_rule = no
		NOT = {
			has_global_variable = mdd_roman_question_answered
		}
	}

	immediate = {
		if = {
			limit = {
				NOT = { has_global_variable = mdd_papal_rule_ended }
			}
			set_global_variable = mdd_papal_rule_ended
			trigger_event = {
				#flavor event that kicks of notification of prisoner in the vatican
				#either secularization of c:PAP or death of the country
				#ideally find a way to save the old pope and/or put him in the void
				# -- maybe set global variable that saves pope character. update every papal succession
				# delay this just in case there is a revolution that temporarily takes rome?
				id = mdd_vatican.1
			}
		}
	}

	on_weekly_pulse = {
		#check for dead popes and new popes
		#if pope is dead and new pope, effect_papal_succession = yes
		#also add the possibility of some of the anti-secularization events if they didn't fire before this kicked off?
	}

	modifiers_while_active = {
		#unclear
	}

	complete = {
		has_global_variable = mdd_roman_question_answered
	}

	on_complete = {
		#add holy see to owning country
	}

	invalid = {
		OR = {
			country_controls_vatican = no
			has_papal_rule = yes
		}
	}

	# add an on_invalid here to handle papal rule coming back
	# removes papal_rule_ended variable, sets pope and ruler of the country, fires flavor event

	can_revolution_inherit = yes

}

je_holy_see = {
	icon = "gfx/interface/icons/religion_icons/catholic.dds"

	group = je_group_mdd_content

	is_shown_when_inactive = {
		country_controls_vatican = yes
		has_papal_rule = no
	}

	possible = {
		has_global_variable = mdd_roman_question_answered
		country_controls_vatican = yes
		has_papal_rule = no
	}

	modifiers_while_active = {
		#prestige? catholic loyalty?
	}

	on_weekly_pulse = {
		#check for dead popes and trigger papal elections
	}

	invalid = {
		country_controls_vatican = no
	}

	can_revolution_inherit = yes

}

#journal entry in vatican country lets a fail trigger if country_controls_vatican = no OR if country_is_papal_states = no
#mass media fuels the fires (requirement for quanta cura?)
#also encompass Quanta cura/syllabus of errors (1864)
#first vatican council is (1870)
#give this to the papal states at game start
je_anti_secularization = {
	icon = "gfx/interface/icons/religion_icons/catholic.dds"

	group = je_group_mdd_content

	# added at game start to papal states
	# is_shown_when_inactive = {	}
	# possible = { }

	fail = {
		OR = {
			country_controls_vatican = no
			has_papal_rule = no
		}	
	}

	on_fail = {
		#?? vatican council immediately? Or nothing
	}

}

#protestant (european protestant?) response to papal infallibility
#include some attacks on cultural minorities that are majority catholic (ie. Poles in Germany)?
#struggle especially over schooling
#triggered by papal infallibility
je_kulturkampf = {
	icon = "gfx/interface/icons/religion_icons/catholic.dds"

	group = je_group_mdd_content

	#added via event? or triggered by infallibility/vatican council global var?
	is_shown_when_inactive = {
		always = no
	}

	possible = {
		always = no
	}
}

#catholic response to papal infallibility
#struggle over state religion and potentially schooling
#triggered by papal infallibility
je_gallicanism = {
	icon = "gfx/interface/icons/religion_icons/catholic.dds"

	group = je_group_mdd_content

	#added via event? or triggered by infallibility/vatican council global var?
	is_shown_when_inactive = {
		always = no
	}

	possible = {
		always = no
	}
}

#triggered after rerum novarum (IRL 1891)
#devout IG in catholic countries can become more liberal and adopt corporatism
je_catholic_social_teaching = {
	icon = "gfx/interface/icons/religion_icons/catholic.dds"

	group = je_group_mdd_content

	#added via event? or triggered by rerum novarum global var?
	#maybe show when corporatism researched or rerum novarum, and possible when rerum novarum
	is_shown_when_inactive = {
		always = no
	}

	possible = {
		always = no
	}

}

#let countries with catholic minorities potentially liberalize as well
je_catholic_social_teaching_minority = {
	icon = "gfx/interface/icons/religion_icons/catholic.dds"

	group = je_group_mdd_content

	#added via event? or triggered by rerum novarum global var?
	#maybe show when corporatism researched or rerum novarum, and possible when rerum novarum
	is_shown_when_inactive = {
		always = no
	}

	possible = {
		always = no
	}

}

